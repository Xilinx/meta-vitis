From 5afe37eb240a562f76dc5b44d7feba5b1ad21c48 Mon Sep 17 00:00:00 2001
From: Tianfang Meng <tianfang@xilinx.com>
Date: Sat, 9 Jan 2021 19:25:25 +0800
Subject: [PATCH] Solve problem of compatibility among different versions of
 python when compiling vart

---
 .../VART/vart/runner/CMakeLists.txt                | 14 +++-----------
 1 file changed, 3 insertions(+), 11 deletions(-)

diff --git a/runner/CMakeLists.txt b/runner/CMakeLists.txt
index b2d3bd8d..5bae61ec 100644
--- a/runner/CMakeLists.txt
+++ b/runner/CMakeLists.txt
@@ -118,27 +118,19 @@ if(BUILD_PYTHON)
   set(MODULE_NAME vart)
   if(CMAKE_CROSSCOMPILING)
     find_package(Python3 REQUIRED COMPONENTS Development)
-    ## pybind11 does not support cross compiling very well
-    find_path(_PYBIND11_PATH pybind11 HINTS /usr/include/python${Python3_VERSION_MAJOR}.${Python3_VERSION_MINOR}m)
-    message("_PYBIND11_PATH is ${_PYBIND11_PATH}")
-    if(NOT _PYBIND11_PATH)
-      message(WARNING "PYBIND11 NOT FOUND. python extenions for vitis dpu runner will not be built.")
-    else()
-      get_filename_component(PYBIND11_PATH ${_PYBIND11_PATH} DIRECTORY)
       add_library(vitis-ai-runner-py SHARED python/runner_py_module.cpp)
       set_target_properties(vitis-ai-runner-py PROPERTIES
-        INCLUDE_DIRECTORIES "${CMAKE_CURRENT_SOURCE_DIR}/include;${_PYBIND11_PATH};${CMAKE_SYSROOT}/usr/include/python${Python3_VERSION_MAJOR}.${Python3_VERSION_MINOR}m"
+	INCLUDE_DIRECTORIES "${CMAKE_CURRENT_SOURCE_DIR}/include;${Python3_INCLUDE_DIRS}"
         COMPILE_DEFINITIONS "MODULE_NAME=${MODULE_NAME}"
         PREFIX ""
         LIBRARY_OUTPUT_NAME "${MODULE_NAME}")
-      target_link_libraries(vitis-ai-runner-py -lpython${Python3_VERSION_MAJOR}.${Python3_VERSION_MINOR}m ${COMPONENT_NAME})
+      target_link_libraries(vitis-ai-runner-py ${Python3_LIBRARIES} ${COMPONENT_NAME})
       install(TARGETS vitis-ai-runner-py
-	    COMPONENT base
+	COMPONENT base
         LIBRARY DESTINATION lib/python${Python3_VERSION_MAJOR}.${Python3_VERSION_MINOR}/site-packages)
       install(FILES python/runner.py
         COMPONENT base
         DESTINATION lib/python${Python3_VERSION_MAJOR}.${Python3_VERSION_MINOR}/site-packages)
-    endif(NOT _PYBIND11_PATH)
   else(CMAKE_CROSSCOMPILING)
     find_package(pybind11 REQUIRED)
 
-- 
2.17.1

