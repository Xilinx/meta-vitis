From b00d3840e309480cab37eabcc2bdecef66b2e54b Mon Sep 17 00:00:00 2001
From: Tianfang Meng <tianfang@xilinx.com>
Date: Sat, 9 Jan 2021 18:19:27 +0800
Subject: [PATCH] Solve problem of compatibility among different versions of
 python when compiling xir

---
 .../VART/xir/src/python/CMakeLists.txt              | 13 ++-----------
 1 file changed, 2 insertions(+), 11 deletions(-)

diff --git a/src/python/CMakeLists.txt b/src/python/CMakeLists.txt
index 26ed3616..5b73d43d 100644
--- a/src/python/CMakeLists.txt
+++ b/src/python/CMakeLists.txt
@@ -21,27 +21,18 @@ set(PYTHON_BUILD_PATH ${CMAKE_BINARY_DIR}/python)
 set(MODULE_SRCS wrapper/wrapper.cpp wrapper/pyxir_error_code.cpp)
 
 if(CMAKE_CROSSCOMPILING)
-  ## pybind11 does not support cross compiling very well
-  find_path(_PYBIND11_PATH pybind11 HINTS /usr/include/python3.7m)
-  message("_PYBIND11_PATH is ${_PYBIND11_PATH}")
-  if(NOT _PYBIND11_PATH)
-    message(WARNING "PYBIND11 NOT FOUND. python extenions for vitis dpu runner will not be built.")
-  else()
     find_package(Python3 REQUIRED COMPONENTS Development)
-    get_filename_component(PYBIND11_PATH ${_PYBIND11_PATH} DIRECTORY)
     add_library(${TARGET_NAME} SHARED ${MODULE_SRCS})
     set_target_properties(${TARGET_NAME} PROPERTIES
-      INCLUDE_DIRECTORIES "${CMAKE_CURRENT_SOURCE_DIR}/include;${_PYBIND11_PATH};${CMAKE_SYSROOT}/usr/\
-include/python${Python3_VERSION_MAJOR}.${Python3_VERSION_MINOR}m;${CMAKE_SOURCE_DIR}/include;${CMAKE_SOURCE_DIR}/src"
+      INCLUDE_DIRECTORIES "${CMAKE_CURRENT_SOURCE_DIR}/include;${Python3_INCLUDE_DIRS};${CMAKE_SOURCE_DIR}/include;${CMAKE_SOURCE_DIR}/src"
       COMPILE_DEFINITIONS "MODULE_NAME=${MODULE_NAME}"
       PREFIX ""
       LIBRARY_OUTPUT_NAME ${MODULE_NAME})
     target_link_libraries(${TARGET_NAME} PRIVATE
-      -lpython${Python3_VERSION_MAJOR}.${Python3_VERSION_MINOR}m
+      ${Python3_LIBRARIES}
       ${PROJECT_NAME})
     set(PYTHON_SITE_PACKAGES_USER "lib/python${Python3_VERSION_MAJOR}.${Python3_VERSION_MINOR}/site-packages")
     set(PYTHON_SITE_PACKAGES "lib/python${Python3_VERSION_MAJOR}.${Python3_VERSION_MINOR}/site-packages")
-  endif(NOT _PYBIND11_PATH)
 else(CMAKE_CROSSCOMPILING)
   find_package(pybind11 REQUIRED)
   set(PYBIND11_CPP_STANDARD -std=c++14)
-- 
2.17.1

